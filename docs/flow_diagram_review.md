# 執行完整流程 — 流程圖審核

## 今日執行狀況對照（2026-02-20）

```
使用者輸入「執行完整流程」
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ 前置檢查                                                          │
├─────────────────────────────────────────────────────────────────┤
│ ✅ 檢查 execution_state.json                                     │
│ ✅ 判斷執行模式（標準每日更新）                                     │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 1: 監控清單追蹤                                              │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 讀取 watchlist.json                                        │
│   ├── 對到期產品重新抓取評論（最新 50 則）                          │
│   ├── WebSearch 搜尋召回新聞                                      │
│   ├── 比對 baseline 數據                                          │
│   └── 偵測重大變化 → 觸發 Step 7-8                                │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ✅ 讀取 watchlist.json                                         │
│   ⏭️ 跳過抓取（無到期項目）                                        │
│   ⏭️ 跳過 WebSearch（無到期項目）                                  │
│   ⏭️ 跳過比對（無到期項目）                                        │
├─────────────────────────────────────────────────────────────────┤
│ 問題：雖然今日無到期，但未執行「補檢查規則」的驗證                    │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 2: 研究缺口補齊                                              │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 掃描所有 [REVIEW_NEEDED] 報告                               │
│   ├── 識別缺口類型（研究不足/競品不足/評論不足）                     │
│   ├── 自動執行補充研究（Step 5）                                   │
│   ├── 或補充抓取（Step 6）                                        │
│   └── 補齊後重新執行 Step 7-8                                     │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ✅ 掃描 REVIEW_NEEDED（找到 26 個）                              │
│   ❌ 未識別各報告的缺口類型                                        │
│   ❌ 未執行任何補齊動作                                            │
│   ❌ 未觸發 Step 7-8 重新分析                                      │
├─────────────────────────────────────────────────────────────────┤
│ 問題：直接跳過，未分析缺口類型，未嘗試補齊                           │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 3: 抓取排行榜（多平台）                                       │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── Amazon Discovery: bestsellers, movers（各品類前 100）       │
│   ├── Best Buy Discovery: best-sellers                           │
│   ├── Walmart Discovery: best-sellers                            │
│   ├── 跨平台 UPC 去重                                             │
│   └── 合併為熱門產品清單                                          │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ⚠️ Amazon: 36 個（目標 100，差 64%）                            │
│   ⚠️ Best Buy: 4 個（selector issue）                             │
│   ⚠️ Walmart: 40 個（僅 toys 成功）                               │
│   ❌ 未執行 UPC 去重                                               │
│   ❌ 未合併為統一清單                                              │
├─────────────────────────────────────────────────────────────────┤
│ 問題：數量嚴重不足，未執行去重和合併                                 │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 4: 產品分組                                                  │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 分析每個產品「解決什麼具體問題」                              │
│   ├── 按問題類別分組                                              │
│   ├── 更新 problem_groups.md                                      │
│   └── 標記狀態（待研究/研究中/已完成）                              │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ⚠️ 僅分析 20/36 個產品（16 個標題不完整）                        │
│   ✅ 建立 3 個新類別                                              │
│   ✅ 更新 problem_groups.md                                       │
├─────────────────────────────────────────────────────────────────┤
│ 問題：44% 產品資訊不足未分組                                       │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 5: 問題研究 + 競品發現                                        │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 12 組關鍵字面向                                             │
│   ├── 20+ 次 WebSearch = 200+ 搜尋結果                            │
│   ├── 100+ 次 WebFetch                                            │
│   ├── 產出 research/{問題}--{date}.md                             │
│   └── 產出 competitors/{問題}--{date}.md                          │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行（3 個新類別）：                                           │
│   ⚠️ disposable-gloves: 8 次 WebSearch, 3 次 WebFetch            │
│   ⚠️ water-bottle: 未報告具體次數                                 │
│   ⚠️ kitchen-scale: 15 次 WebSearch, 20+ 次 WebFetch             │
│   ✅ 研究報告已產出                                               │
│   ✅ 競品清單已產出                                               │
├─────────────────────────────────────────────────────────────────┤
│ 問題：WebSearch/WebFetch 次數遠低於規範（應 20+/100+）             │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 6: 抓取評論 + 萃取                                           │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 抓取原產品 + 競品評論                                        │
│   ├── 執行 fetch.sh                                               │
│   ├── L1-L6 萃取（每個 JSONL）                                    │
│   ├── 批次合併（若 batch_total > 1）                              │
│   └── 執行 update.sh                                              │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ✅ 執行 fetch.sh（85 個產品）                                   │
│   ⚠️ 25 個成功，60 個失敗（Session 過期）                         │
│   ⚠️ 僅萃取 5 個產品                                              │
│   ❌ 未萃取其餘 20 個有資料的產品                                   │
│   ❌ 未執行 update.sh                                              │
├─────────────────────────────────────────────────────────────────┤
│ 問題：萃取不完整（5/25），未執行 update.sh                          │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 7: 比較分析                                                  │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 輸入 Step 6 萃取結果                                        │
│   ├── 跨平台評論整合（UPC 匹配）                                   │
│   ├── 負評三分類                                                  │
│   └── 判斷產品是否能解決問題                                       │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ❌ 未使用萃取結果進行分析                                        │
│   ❌ 未執行跨平台整合                                              │
│   ❌ 未執行負評三分類                                              │
│   ⚠️ 僅基於研究資料產出（非萃取結果）                              │
├─────────────────────────────────────────────────────────────────┤
│ 問題：完全跳過萃取結果分析，直接用研究資料                           │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ Step 8: 產出報告                                                  │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 依分析結果選擇報告類型                                       │
│   ├── 推薦報告 / 比較報告 / 警告報告 / 痛點報告                     │
│   └── 通過自我審核 Checklist                                      │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ✅ 產出 3 個比較報告                                            │
│   ⚠️ 全部標記 [REVIEW_NEEDED]                                     │
│   ❌ 未執行自我審核 Checklist                                      │
├─────────────────────────────────────────────────────────────────┤
│ 問題：報告基於不完整資料，未執行審核                                 │
└─────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────┐
│ 執行結束必做事項                                                   │
├─────────────────────────────────────────────────────────────────┤
│ 規範要求：                                                        │
│   ├── 1. 更新 watchlist.json                                      │
│   ├── 2. 更新 execution_state.json                                │
│   ├── 3. 產出每日摘要                                             │
│   ├── 4. 顯示精簡版摘要                                           │
│   ├── 5. 更新 README.md 健康度儀表板                               │
│   ├── 6. 更新 docs/README.md 首頁                                 │
│   ├── 7. 本地 SEO 驗證                                            │
│   ├── 8. Git commit + push                                        │
│   ├── 9. 等待部署 + 全站 SEO 驗證                                  │
│   ├── 10. 驗證網站更新                                            │
│   └── 11. 記錄 GitHub Traffic 數據                                │
├─────────────────────────────────────────────────────────────────┤
│ 今日執行：                                                        │
│   ❌ 1. 未更新 watchlist.json                                     │
│   ✅ 2. 更新 execution_state.json                                 │
│   ✅ 3. 產出每日摘要                                              │
│   ✅ 4. 顯示精簡版摘要                                            │
│   ❌ 5. 未更新 README.md 健康度儀表板                              │
│   ❌ 6. 未更新 docs/README.md 首頁                                 │
│   ✅ 7. 本地 SEO 驗證                                             │
│   ✅ 8. Git commit + push                                         │
│   ✅ 9. 等待部署完成                                              │
│   ✅ 10. 驗證網站更新                                             │
│   ❌ 11. 未記錄 GitHub Traffic 數據                               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 問題彙整

### 完全跳過的步驟

| Step | 規範動作 | 實際執行 | 嚴重度 |
|------|---------|---------|--------|
| Step 2 | 識別缺口類型 + 執行補齊 | 僅掃描，未補齊 | 🔴 高 |
| Step 3 | UPC 去重 + 合併清單 | 未執行 | 🟠 中 |
| Step 6 | 萃取全部有資料的 JSONL | 僅萃取 5/25 | 🔴 高 |
| Step 6 | 執行 update.sh | 未執行 | 🟠 中 |
| Step 7 | 使用萃取結果分析 | 用研究資料替代 | 🔴 高 |
| Step 8 | 執行自我審核 Checklist | 未執行 | 🟠 中 |

### 數量不足的步驟

| Step | 規範要求 | 實際數量 | 達成率 |
|------|---------|---------|--------|
| Step 3 | 各品類前 100 | Amazon 36, Best Buy 4, Walmart 40 | 27% |
| Step 5 | 20+ WebSearch | 8-15 次 | 40-75% |
| Step 5 | 100+ WebFetch | 3-20+ 次 | 3-20% |
| Step 6 | 萃取所有 JSONL | 5/25 | 20% |

### 必做事項漏掉

| 項目 | 狀態 |
|------|------|
| 更新 watchlist.json | ❌ |
| 更新 README.md 健康度儀表板 | ❌ |
| 更新 docs/README.md 首頁 | ❌ |
| 記錄 GitHub Traffic 數據 | ❌ |

---

## 建議：強制執行規則

為確保每個步驟都不被跳過，建議增加以下機制：

### 1. 每個 Step 必須有明確的「完成條件」

```
Step 1 完成條件：
├── watchlist.json 中所有到期項目都已檢查
├── 每個檢查項目有 check_result
└── last_checked 已更新

Step 2 完成條件：
├── 每個 REVIEW_NEEDED 報告都有缺口類型標記
├── 至少嘗試補齊一個缺口（或記錄為何無法補齊）
└── 補齊結果記錄在 watchlist.json.completed_gap_fills

... 以此類推
```

### 2. 強制產出物清單

每個 Step 必須產出：

| Step | 必要產出物 |
|------|-----------|
| Step 1 | watchlist.json 更新 |
| Step 2 | gap_analysis_{date}.json |
| Step 3 | discovery_cache/{date}.json（含去重結果） |
| Step 4 | problem_groups.md 更新 |
| Step 5 | research/*.md + competitors/*.md |
| Step 6 | 所有 JSONL 對應的 .md 萃取檔案 |
| Step 7 | comparison_analysis_{類別}_{date}.json |
| Step 8 | Narrator 報告 + 審核 Checklist 結果 |

### 3. 不允許「因為 XX 所以跳過」

目前的跳過理由：
- 「今日無到期項目」→ 應該還是要驗證 watchlist 完整性
- 「Session 過期」→ 應該要求重新登入或標記待補
- 「時間考量」→ 不是有效理由

---

## 下一步

請確認：
1. 上述哪些步驟的規範需要調整？
2. 哪些步驟可以接受簡化版執行？
3. 強制執行規則是否可接受？
